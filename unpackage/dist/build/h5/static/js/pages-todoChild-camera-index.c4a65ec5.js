(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-todoChild-camera-index"],{2618:function(t,e,n){"use strict";var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n("bd86"));n("96cf");var o=i(n("3b8d"));n("c5f6");var r,u=n("e2a7"),c=n("4cc3"),s=n("0ae1"),l=n("5d67"),d=n("02f9"),f={feikeError:"https://www.feiaizn.com/images/feike.mp3",success:"https://www.feiaizn.com/images/success.mp3"},p={name:"canvas-drawer",data:function(){return{canvasWidth:752,canvasHeight:808,cover:"https://s2.ax1x.com/2019/10/08/ufSasU.jpg",imgphoto:"",needLocation:[{id:1,name:"客厅",video:"https://www.feiaizn.com/images/keting.mp3"},{id:2,name:"餐厅",video:"https://www.feiaizn.com/images/canting.mp3"},{id:3,name:"厨房",video:"https://www.feiaizn.com/images/chufang.mp3"},{id:4,name:"卫生间",video:"https://www.feiaizn.com/images/weishengjian.mp3"},{id:5,name:"卧室",video:"https://www.feiaizn.com/images/woshi.mp3"},{id:6,name:"卧室",video:"https://www.feiaizn.com/images/woshi.mp3"}],currentVideoIndex:0,isLoading:!1,address:"",latitude:"",longitude:"",role:0,disable:!1,uuid:""}},onLoad:function(t){var e=this;r=this,uni.getSetting({success:function(n){if(!n.authSetting["scope.userLocation"]&&n.authSetting.hasOwnProperty("scope.userLocation"))fkConfirm({title:"温馨提示",content:"非客有家检测到您还没授权定位或拍照功能，是否去前去授权？",successFunction:function(){uni.openSetting({})},failFunction:function(){uni.showToast({title:"取消授权则无法使用该功能，即将退出拍照页面!",icon:"none",duration:2e3,success:function(){uni.navigateBack()}})}});else if("face"==t.role){var i=getCurrentPages(),a=(i[i.length-1],i[i.length-2]);a.setData({num:Number(t.index)}),console.log(Number(t.index)),uni.playBackgroundAudio({dataUrl:e.needLocation[Number(t.num)].video}),e.checkLocation(),r.role=0}else r.role=1,r.location=JSON.parse(decodeURIComponent(t.location)),console.log(t),r.latitude=t.latitude,r.longitude=t.longitude,r.latitude=22.71991,r.longitude=114.24779,r.uuid=t.uuid,e.checkPhotoLocation()}})},methods:{photo:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(){var e,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=uni.createCameraContext(),console.log(e),uni.showLoading({title:"照片上传中"}),t.next=5,e.takePhoto({quality:"high",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e),t.next=3,uni.uploadFile({url:u.UPLOADPHOTO,header:(0,a.default)({"Content-Type":"multipart/form-data"},"Content-Type","application/json"),filePath:e.tempImagePath,name:"file",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e){var i,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e),i=JSON.parse(e.data),uni.getSystemInfoSync(),d=uni.createCanvasContext("firstCanvas"),t.next=6,uni.getImageInfo({src:i.data,success:function(t){console.log(t.path),d.drawImage(t.path,0,0,375,uni.upx2px(1020));var e=d.createLinearGradient(0,0,800,0);e.addColorStop("0.25","#8b00d2"),e.addColorStop("0.5","#003fb3"),e.addColorStop("0.75","#ff3ef0"),d.font="13px Arial",d.fillStyle="#fff",d.fillText(n.address,uni.upx2px(20),uni.upx2px(1e3)),d.font="13px Arial",d.fillStyle="#fff",d.fillText((0,c.formatTime)(new Date),uni.upx2px(20),uni.upx2px(970)),d.draw(!1,(function(){uni.canvasToTempFilePath({x:0,y:0,width:375,height:uni.upx2px(1020),destWidth:375,destHeight:uni.upx2px(1020),canvasId:"firstCanvas",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e),r.imgphoto=e.tempFilePath,t.next=4,uni.uploadFile({header:(0,a.default)({"Content-Type":"multipart/form-data"},"Content-Type","application/json"),url:u.UPLOADPHOTO,filePath:e.tempFilePath,name:"file",success:function(t){console.log(t);var e={uuid:n.uuid,url:JSON.parse(t.data).data,potId:n.location[n.currentVideoIndex],latitude:n.latitude,longitude:n.longitude};(0,l.photoSubmit)(e).then((function(t){r.currentVideoIndex=n.currentVideoIndex+1,setTimeout((function(){uni.hideLoading(),uni.showToast({title:"成功",icon:"success",duration:2e3})}),100),n.currentVideoIndex<n.location.length?uni.playBackgroundAudio({dataUrl:n.needLocation[Number(n.location[n.currentVideoIndex])].video}):uni.playBackgroundAudio({dataUrl:f.success,success:function(){console.log("拍照完成，跳回前一页"),uni.switchTab({url:s.MINE})}})}))}});case 4:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),fail:function(t){console.log(t),uni.showToast({title:"拍照失败",icon:"none"})}})}))},fail:function(t){setTimeout(uni.hideLoading,100),console.log(t)}});case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()});case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()});case 5:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),qrR:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(){var e,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=uni.createCameraContext(),console.log(e),uni.showLoading({title:"照片上传中"}),t.next=5,e.takePhoto({quality:"high",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e),t.next=3,uni.uploadFile({url:u.UPLOADPHOTO,header:(0,a.default)({"Content-Type":"multipart/form-data"},"Content-Type","application/json"),filePath:e.tempImagePath,name:"file",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e),i=JSON.parse(e.data),uni.getSystemInfoSync(),a=uni.createCanvasContext("firstCanvas"),t.next=6,uni.getImageInfo({src:i.data,success:function(t){console.log(t.path),a.drawImage(t.path,0,0,375,uni.upx2px(1020));var e=a.createLinearGradient(0,0,800,0);e.addColorStop("0.25","#8b00d2"),e.addColorStop("0.5","#003fb3"),e.addColorStop("0.75","#ff3ef0"),a.font="13px Arial",a.fillStyle="#fff",a.fillText(n.address,uni.upx2px(20),uni.upx2px(1e3)),a.font="13px Arial",a.fillStyle="#fff",a.fillText((0,c.formatTime)(new Date),uni.upx2px(20),uni.upx2px(970)),a.draw(!1,(function(){uni.canvasToTempFilePath({x:0,y:0,width:375,height:uni.upx2px(1020),destWidth:375,destHeight:uni.upx2px(1020),canvasId:"firstCanvas",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(e),r.imgphoto=e.tempFilePath,n=getCurrentPages(),n[n.length-1],i=n[n.length-2],i.setData({imgphoto:e.tempFilePath}),setTimeout((function(){uni.hideLoading(),uni.showToast({title:"成功",icon:"success",duration:2e3})}),100),uni.navigateBack();case 8:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),fail:function(t){console.log(t),uni.showToast({title:"拍照失败",icon:"none"})}})}))},fail:function(t){setTimeout(uni.hideLoading,100),console.log(t)}});case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()});case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()});case 5:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),_previewImage:function(t){var e=[];e.push(t),uni.previewImage({urls:e,current:e[0]})},checkLocation:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=new d({key:"RXMBZ-V3XKW-EPHR7-R7B2O-S75AK-3TFHW"}),t.next=3,uni.getLocation({type:"gcj02",altitude:"true",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.reverseGeocoder({location:{latitude:n.latitude,longitude:n.longitude},success:function(t){console.log(n),r.address=t.result.formatted_addresses.recommend,r.latitude=n.latitude,r.longitude=n.longitude;var e=getCurrentPages(),i=(e[e.length-1],e[e.length-2]);i.setData({latitude:n.latitude,longitude:n.longitude})}});case 1:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()});case 3:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),checkPhotoLocation:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e,n){var i,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new d({key:"RXMBZ-V3XKW-EPHR7-R7B2O-S75AK-3TFHW"}),t.next=3,uni.getLocation({type:"gcj02",altitude:"true",success:function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i.reverseGeocoder({location:{latitude:e.latitude,longitude:e.longitude},success:function(t){console.log(e),r.address=t.result.formatted_addresses.recommend,console.log(a);var n=(0,c.getDistance)({lat1:e.latitude,lng1:e.longitude,lat2:Number(a.latitude),lng2:Number(a.longitude)});n>10&&0==e.altitude?(uni.playBackgroundAudio({dataUrl:f.feikeError}),r.disable=!0):(uni.playBackgroundAudio({dataUrl:a.needLocation[Number(a.location[0])].video}),r.disable=!1)}});case 1:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()});case 3:case"end":return t.stop()}}),t)})));function e(e,n){return t.apply(this,arguments)}return e}()}};e.default=p},"2df1":function(t,e,n){"use strict";var i=n("9c89"),a=n.n(i);a.a},"4cc3":function(t,e,n){"use strict";n("20d6"),n("c5f6"),n("28a5"),n("a481"),n("6b54");var i=function(t){var e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),o=t.getHours(),r=t.getMinutes(),u=t.getSeconds();return[e,n,i].map(a).join("/")+" "+[o,r,u].map(a).join(":")},a=function(t){return t=t.toString(),t[1]?t:"0"+t},o=function(t){t=t.toString().length<13?1e3*t:t;var e=new Date(t),n=e.getFullYear()+"-",i=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",a=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",o=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",r=(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":",u=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return n+i+a+o+r+u},r=function(t,e){if(""===t.trim()){var n=e?e+"不可为空":"不可为空";return uni.showToast({title:n,icon:"none",mask:!0,duration:2e3}),!1}return!0},u=function(t,e){if(t=t.toString(),""===t.trim()){var n=e?e+"不可为空":"手机号不可为空";return uni.showToast({title:n,icon:"none",mask:!0,duration:2e3}),!1}var i=/^((13[0-9])|(14[5,7])|(15[0-3,5-9])|(17[0,3,5-8])|(18[0-9])|166|198|199|(147))\d{8}$/gi,a=i.test(t);if(!a){var o=e?"请输入正确"+e:"请输入正确手机号";return uni.showToast({title:o,icon:"none",mask:!0,duration:2e3}),!1}return!0},c=function(t,e){if(t=t.toString(),""===t.trim()){var n=e?e+"不可为空":"身份证不可为空";return uni.showToast({title:n,icon:"none",mask:!0,duration:2e3}),!1}if(18!=t.length){var i=e?"请输入正确"+e:"请输入正确身份证号";return uni.showToast({title:i,icon:"none",mask:!0,duration:2e3}),!1}return!0},s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.ox,n=void 0===e?0:e,i=t.oy,a=void 0===i?0:i,o=t.ax,r=void 0===o?0:o,u=t.ay,c=void 0===u?0:u,s=t.angle,l=void 0===s?0:s,d={c:0,d:0};return d.c=parseInt(n+(r-n)*Math.cos(l)+(c-a)*Math.sin(l)),d.d=parseInt(a+(r-n)*-Math.sin(l)+(c-a)*Math.cos(l)),d},l=function(t){return null==t?0:("string"!=typeof t&&(t+=""),t.replace(/[^a-z]\d*/g,"01").length)};function d(t,e){var n,i,a;try{n=t.toString().split(".")[1].length}catch(o){n=0}try{i=e.toString().split(".")[1].length}catch(o){i=0}return a=Math.pow(10,Math.max(n,i)),((t*a+e*a)/a).toFixed(2)}function f(t,e){var n,i,a;try{n=t.toString().split(".")[1].length}catch(o){n=0}try{i=e.toString().split(".")[1].length}catch(o){i=0}return a=Math.pow(10,Math.max(n,i)),n>=i?n:i,((t*a-e*a)/a).toFixed(2)}function p(t,e){var n=0,i=t.toString(),a=e.toString();try{n+=i.split(".")[1].length}catch(o){}try{n+=a.split(".")[1].length}catch(o){}return Number(i.replace(".",""))*Number(a.replace(".",""))/Math.pow(10,n)}function h(t,e){if("function"!==typeof t)return console.warn("func 参数必须是Function类型"),function(){};if("number"!==typeof e)return console.warn("delay 参数必须是Number类型"),function(){};var n=Date.now();return function(){Date.now()-n>=e&&(t.call(this,arguments),n=Date.now())}}function g(t,e){if("function"!==typeof t)return console.warn("func 参数必须是Function类型"),function(){};if("number"!==typeof e)return console.warn("wait 参数必须是Number类型"),function(){};var n=null;return function(){null!==n&&clearTimeout(n),n=setTimeout(t,e)}}function m(t){var e=getCurrentPages(),n=e.findIndex((function(e){return e.route==t.substring(1)}));-1!=n?uni.navigateBack({delta:e.length-n-1}):uni.navigateTo({url:t,fail:function(){uni.switchTab({url:t})}})}var v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.lat1,n=void 0===e?0:e,i=t.lng1,a=void 0===i?0:i,o=t.lat2,r=void 0===o?0:o,u=t.lng2,c=void 0===u?0:u,s=n*Math.PI/180,l=r*Math.PI/180,d=s-l,f=a*Math.PI/180-c*Math.PI/180,p=6378137,h=2*p*Math.asin(Math.sqrt(Math.pow(Math.sin(d/2),2)+Math.cos(s)*Math.cos(l)*Math.pow(Math.sin(f/2),2)));return parseInt(h)};t.exports={formatTime:i,time:o,checkRequestStr:r,checkPhone:u,checkIdCardLength:c,anglePoint:s,getBLen:l,accAdd:d,subtr:f,accMul:p,waterTap:h,debounce:g,toRoute:m,getDistance:v}},"5d67":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.myWorkFace=o,e.myWorkPhoto=r,e.myWorkPhotoLocation=u,e.photoSubmit=c;var i=n("133c"),a=n("e2a7");function o(t){return(0,i.request)({method:"GET",url:a.MYWORK_FACE,showSuccessToast:!0,data:t})}function r(t){return(0,i.request)({method:"GET",url:a.MYWORKPHOTO,showSuccessToast:!0,data:t})}function u(t){return(0,i.request)({method:"GET",url:a.MYWORKPHOTO_LOCATION,showSuccessToast:!0,data:t})}function c(t){return(0,i.request)({method:"POST",url:a.PHOTO_SUMBIT,showSuccessToast:!0,data:t})}},8014:function(t,e,n){"use strict";n.r(e);var i=n("d21b"),a=n("cc95");for(var o in a)"default"!==o&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n("2df1");var r,u=n("f0c5"),c=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"4fdf7f66",null,!1,i["a"],r);e["default"]=c.exports},"9c89":function(t,e,n){var i=n("eadd");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=n("4f06").default;a("ea986da6",i,!0,{sourceMap:!1,shadowMode:!1})},cc95:function(t,e,n){"use strict";n.r(e);var i=n("2618"),a=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},d21b:function(t,e,n){"use strict";var i,a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"content",staticStyle:{position:"absolute",width:"100%",height:"100%"}},[n("v-uni-canvas",{staticClass:"canvas",style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px"},attrs:{"canvas-id":"firstCanvas"}}),n("v-uni-view",{staticStyle:{position:"absolute",width:"100%",height:"100%","z-index":"1000"}},[n("v-uni-camera",{staticStyle:{width:"100%",height:"80%"},attrs:{"device-position":"back",flash:"off","frame-size":"large"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.error.apply(void 0,arguments)}}}),n("v-uni-view",{staticStyle:{width:"100%",height:"20%",display:"flex","justify-content":"center","align-items":"center",background:"#000000",position:"relative"}},[0==t.role?n("v-uni-view",{staticStyle:{width:"50px",height:"50px","border-radius":"50%",background:"#FFFFFF","text-align":"center","line-height":"50px"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.qrR.apply(void 0,arguments)}}},[n("v-uni-icon",{staticClass:"iconfont iconpaizhao iconclass"})],1):t._e(),1==t.role?n("v-uni-button",{staticStyle:{width:"50px",height:"50px","border-radius":"50%",background:"#FFFFFF","text-align":"center","line-height":"50px"},attrs:{disabled:t.disable},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.photo.apply(void 0,arguments)}}},[n("v-uni-icon",{staticClass:"iconfont iconpaizhao iconclass"})],1):t._e(),t.imgphoto?n("v-uni-image",{staticStyle:{position:"absolute",left:"20px",top:"35px",width:"50px",height:"50px","border-radius":"50%",display:"block"},attrs:{src:t.imgphoto},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t._previewImage(t.imgphoto)}}}):t._e()],1)],1)],1)},o=[];n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}))},eadd:function(t,e,n){var i=n("24fb");e=i(!1),e.push([t.i,'@charset "UTF-8";\n/* Color\r\n--------------------------*/\n/* distance\r\n--------------------------*/\n/* radius\r\n--------------------------*/\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.post[data-v-4fdf7f66]{height:100%;background-color:#f4f4f4}.post .wrapper[data-v-4fdf7f66]{height:%?1020?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;margin-top:%?50?%}.iconclass[data-v-4fdf7f66]{font-size:14px}.canvas[data-v-4fdf7f66]{position:fixed;top:100%;left:0;width:100%;height:100%;visibility:hidden}',""]),t.exports=e}}]);